{
  "hash": "5d92a2e5411658ff076e77768811dac1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Simulation code\"\nauthor: \"Maël Delem\"\n# code reading options\ncode-fold: false\n---\n\n\n\n\n::: {.callout-note collapse=\"true\"}\n## Packages and setup\n\nDown below is the code to load necessary packages used for the simulation and analysis, along with some setups for the whole document (*hover over the numbers on the far right for additional explanation of code and mechanics*).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| output: false\n#| echo: true\n\n# ═══ Packages ═════════════════════════════════════════════════════════════════\n\nif (!require(librarian)) install.packages(librarian)   # <1>\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLe chargement a nécessité le package : librarian\n```\n\n\n:::\n\n```{.r .cell-code}\n#| output: false\n#| echo: true\n\nlibrary(librarian)                                     # <1>      \n\n# now putting packages on our library's shelves:\nshelf(\n  # ─── data management ─────────────────\n  holodeck,       # simulating multivariate data\n  cluster,        # dissimilarity matrices\n  \n  # ─── modelling ───────────────────────\n  mclust,         # mixture clustering\n  \n  #  data visualization ──────────────\n  # palettes\n  viridis,        # colour-blind friendly palettes\n  # interactive\n  plotly,         # interactive plots\n  ggdendro,       # dendrograms\n  seriation,      # dissimilarity plots\n  webshot2,       # HTML screenshots for Word render\n  webshot,\n  \n  # ─── essential package collections ───\n  doParallel,     # parallel execution\n  easystats,      # data analysis ecosystem\n  reticulate,     # R to Python                       # <2>\n  tidyverse,      # modern R ecosystem\n)\n\n# ─── Global cosmetic theme ───\ntheme_set(theme_modern(base_size = 14))\n\npal_okabe_ito <- c(     # <3>                                                \n  \"#E69F00\", \"#56B4E9\", \"#009E73\",                            \n  \"#F5C710\", \"#0072B2\", \"#D55E00\", \"#CC79A7\", \"#6c0009\")      \n\n# We'll need 9 colors at some point\npal_okabe_ito_extended <- c(                                 \n  \"#E69F00\", \"#56B4E9\", \"#009E73\",                           \n  \"#F5C710\", \"#0072B2\", \"#D55E00\", \"#CC79A7\", \"#6c0009\", \"#414487FF\")\n\n# We'll need 30 colors at another moment\ncool_30_colors <- c(                                                   \n  \"#3d51b4\", \"#414487FF\", \"#003d73\", \"#440154FF\", \"#6c0009\", \"#b64e4e\",\n  \"#D55E00\", \"#E69F00\", \"#F5C710\", \"#FDE725FF\", \"#f2bb7b\", \"#f1afad\", \"#CC79A7\", \n  \"#e57774\", \"#7AD151FF\", \"#57b571\", \"#318a4a\", \"#009E73\", \"#22A884FF\", \n  \"#2A788EFF\", \"#0072B2\", \"#2da6b5\", \"#56B4E9\", \"#889be0\", \"#6677e0\",   \n  \"#3d51b4\", \"#414487FF\", \"#003d73\", \"#440154FF\", \"#6c0009\", \"#b64e4e\"  \n  ) # <3>                                                                      \n\npath = \"data/\"\n\ndf <- read_rds(paste0(path, \"df.RDS\")) # <4>\ndf_embeds <- read_rds(paste0(path, \"df_embeds.RDS\"))\n# Categorical and visual embeddings\ndf_embeds_categ  <- read_rds(paste0(path, \"df_embeds_categ.RDS\"))\ndf_embeds_visual <- read_rds(paste0(path, \"df_embeds_visual.RDS\"))\n# Subject embeddings per sub-group\ndf_embed_c_sub  <- read_rds(paste0(path, \"df_embed_c_sub.RDS\"))\ndf_embed_cs_sub <- read_rds(paste0(path, \"df_embed_cs_sub.RDS\"))\ndf_embed_v_sub  <- read_rds(paste0(path, \"df_embed_v_sub.RDS\"))\ndf_embed_vs_sub <- read_rds(paste0(path, \"df_embed_vs_sub.RDS\"))\n# Accuracy of the unsupervised alignment (bad = not tidy data)\ndf_accuracy_all_bad <- read_rds(paste0(path, \"df_accuracy_all_bad.RDS\"))\ndf_accuracy_cat_bad <- read_rds(paste0(path, \"df_accuracy_cat_bad.RDS\"))\n# Coordinates of the aligned embeddings from the Python output\ncoordinates_aligned_embeddings <- read_rds(paste0(path, \"coordinates_aligned_embeddings.RDS\")) # <4>\n```\n:::\n\n\n\n1.  The package `librairian` eases package management with the \"shelf\" function, which automatically: (1) checks if a package is installed; (2) installs it if need be; (3) loads the package like the \"library()\" function would.\n2.  `reticulate` allows to translate and transfer objects and functions from R to Python and vice-versa, and was thus of primary importance for the successful use of the Python toolbox on our simulated data.\n3.  These are personal custom color palettes meant to extend my favourite palette, the color-atypical friendly Okabe-Ito color palette. The palette originally has only eight colors, but I will need nine, then up to 30 for later graphs, so I extended it with a hand-picked selection of mine.\n4. These are R objects that were the results of a previous run of the simulation.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Generating hypothetical imagery values for 30 subjects\"}\n#| code-summary: \"Generating hypothetical imagery values for 30 subjects\"\n#| label: osv-model\n#| echo: true\n#| eval: false\n\n# The function takes the variance and covariance of the imagery distributions\n# as arguments\ngenerate_osv_model <- function(var, cov){\n  df <- \n    tibble(group = rep(c(\"aph\", \"phant\"), each = 8)) |> \n    group_by(group) |> \n    mutate(\n      spatial_group = c(rep(\"spa_low\", 4), rep(\"spa_high\", 4)),\n      vis_spa_group = paste0(group, \"_\", spatial_group),\n      verbal_group = \"verbal_low\",\n      verbal_group  = case_when(\n        vis_spa_group == \"aph_spa_low\" ~ \"verbal_high\", \n        vis_spa_group == \"phant_spa_low\" ~ \"verbal_mid\",\n        TRUE ~ verbal_group)\n    ) |> \n    group_by(vis_spa_group) |> \n    # ─── visual ───\n    sim_discr(\n      n_vars = 1, \n      var = var, \n      cov = cov, \n      # aph_s, aph_v, phant_s, phant_v\n      group_means = c(0, 0, 0.6, 0.87), \n      name = \"v\") |> \n    # ─── spatial ───\n    sim_discr(\n      n_vars = 1,  \n      var = var, \n      cov = cov, \n      # aph_s, aph_v, phant_s, phant_v\n      group_means = c(0.75, 0.4, 0.7, 0.3), \n      name = \"s\") |>\n    # ─── verbal ───\n    sim_discr(\n      n_vars = 1,  \n      var = var, \n      cov = cov, \n      # aph_s, aph_v, phant_s, phant_v\n      group_means = c(0.3, 0.7, 0.3, 0.5), \n      name = \"i\") |>\n    rename(\n      visual_imagery  = v_1,\n      spatial_imagery = s_1,\n      verbal_profile  = i_1\n      )\n}\n\ndf <- generate_osv_model(0.03, 0)\n```\n:::",
    "supporting": [
      "simulation-code_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}